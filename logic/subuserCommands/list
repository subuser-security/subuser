#!/usr/bin/env python
# This file should be compatible with both Python 2 and 3.
# If it is not, please file a bug report.
import sys
import os
import subuserlib.utils
import subuserlib.registry
import subuserlib.paths
import subuserlib.permissions
import subuserlib.availablePrograms

def printHelp():
  print("""List subuser-programs:
  $ subuser list [options]
  
  OPTIONS:
  --available 
      List all subuser-programs
  --installed 
      List all subuser-programs which are already installed/registered
  --short 
      output only program names

  EXAMPLES:
    $ subuser list --available --short
    $ subuser list --installed
""")

#################################################################################################
if len(sys.argv) == 1 or sys.argv[1] == "help" or sys.argv[1] == "-h" or sys.argv[1] == "--help":
  printHelp()
  sys.exit()
#################################################################################################

commandOptionList = ['--available', '--installed', '--short']
userProgramList, userOptionList = subuserlib.utils.getUserCommandLine(sys.argv[1:], commandOptionList, allowOnlyOptions=True)

#ERROR if user specifies any programs
if userProgramList:
  printHelp()
  sys.exit()
  
#Check exclusive commands
if '--available' in userOptionList and '--installed' in userOptionList:
  print("\nEXCLUSIVE-OPTION-ERROR: you can not use these options together:")
  exclusiveCommandOption = ["--available", "--installed"]
  print(subuserlib.utils.getExclusiveCommandOptionText(exclusiveCommandOption, addNewLine=True, indentSpaces=3))
  sys.exit()


if '--available' in userOptionList:
  if '--short' in userOptionList:
    print(subuserlib.availablePrograms.getAvailableProgramsText(addNewLine=False, indentSpaces=3))
  else:
    availablePrograms = subuserlib.availablePrograms.getAvailablePrograms()
    for program in availablePrograms:
      permissions = subuserlib.permissions.getPermissions(program)
      print(program)
      print("----------------")
      print("Description: "+permissions["description"])
      print("Maintainer: "+permissions["maintainer"])
      print("\n")
elif '--installed' in userOptionList:
  #use this in case the user specified also some program names plus --installed
  userProgramList = list(set(userProgramList + subuserlib.registry.getInstalledPrograms())) 
  if '--short' in userOptionList:
    print(subuserlib.registry.getInstalledProgramsText(addNewLine=False, indentSpaces=3))
  else:
    installedePrograms = subuserlib.registry.getInstalledPrograms()
    for program in installedePrograms:
      permissions = subuserlib.permissions.getPermissions(program)
      print(program)
      print("----------------")
      print("Description: "+permissions["description"])
      print("Maintainer: "+permissions["maintainer"])
      print("\n")
